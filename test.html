<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      #map-canvas { width:550px; height:500px; position: fixed;}
      .layer-wizard-search-label { font-family: sans-serif };
      #content{
                  font-family: Helvetica;
                  font-size: 11px;
      }
    </style>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Mobile Friendly -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <title>UAtilize: Class Utilization</title>

    <link rel="stylesheet" href="./css/iThing.css" type="text/css" />
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBCUrI0pf3RkNiyaPuKULR5evgEj3UJvpI">
    </script>
    <script type="text/javascript">
      google.load('visualization', '1', { packages: ['table'] });
      google.load('visualization', '1', { packages: ['corechart'] });
      
      google.setOnLoadCallback(drawTable);
      google.load('visualization', '1', { packages: ['table'] });
      google.load('visualization', '1', { packages: ['corechart'] });
      
      google.setOnLoadCallback(drawTable);
      function drawTable() {
        var query = "SELECT latitude as Lat, longitude as Lng, Bldg_Name as Building_Name, Bldg_Img, SUM(Student_Count) as Student_Count"+" FROM 1oUa_hu9jie_PeOte55TElLs6DSDPUKb2O5mkmtCd";
        var query1 = "SELECT 'Bldg_Name' as Building_Name, SUM(Student_Count) as Student_Count"+" FROM 1oUa_hu9jie_PeOte55TElLs6DSDPUKb2O5mkmtCd";
        var Building = document.getElementById('Building').value;
        // Days Variables:
        var daySelector = document.getElementById('daySelector').value;
        // Hours Variables:
        var Start = document.getElementById('Start').value;
        var End = document.getElementById('End').value;
        if (Building) {
          query += " WHERE Bldg_Name = '" + Building + "'";
          query1 += " WHERE Bldg_Name = '" + Building + "'";//AND Meeting_Time_Start >= '9:15 AM' AND Meeting_Time_End <= '10:30 AM'";
        }
        if(daySelector){
          if(!Building){
            query += " WHERE "+ daySelector + " = 'Y'";
            query1 += " WHERE "+ daySelector + " = 'Y'";
          }else{
            query += " AND "+ daySelector + " = 'Y'";
            query1 += " AND "+ daySelector + " = 'Y'";
          }
        }
        // Adapting Class Hours ...
        if (Start && End){
          if(!Building && !daySelector){
            query += " WHERE Meeting_Time_Start >= '"+ Start +"' AND Meeting_Time_End <='"+ End +"'";
            query1 += " WHERE Meeting_Time_Start >= '"+ Start +"' AND Meeting_Time_End <='"+ End +"'";
          }else{
            query += " AND Meeting_Time_Start >= '"+ Start +"' AND Meeting_Time_End <='"+ End +"'";
            query1 += " AND Meeting_Time_Start >= '"+ Start +"' AND Meeting_Time_End <='"+ End +"'";
          }
        }
        // GROUP BY Building name
        query += " GROUP BY 'Bldg_Name', 'latitude', 'longitude', 'Bldg_Img'";
        query1 += " GROUP BY 'Bldg_Name'";
        var queryText1 = encodeURIComponent(query1);
        var queryText = encodeURIComponent(query);
        var gvizQuery = new google.visualization.Query(
            'https://www.google.com/fusiontables/gvizdata?tq=' + queryText1);
        var gvizQuery2 = new google.visualization.Query(
            'https://www.google.com/fusiontables/gvizdata?tq=' + queryText1);
        // Query for sending to Google Maps framework ...
        var Query = new google.visualization.Query(
            'https://www.google.com/fusiontables/gvizdata?tq=' + queryText);
        gvizQuery.send(function(response) {
          var table = new google.visualization.Table(
              document.getElementById('visualization'));
          table.draw(response.getDataTable(), {
            showRowNumber: true
          });
        });
        gvizQuery2.send(function(response) {
          var chart = new google.visualization.PieChart(
              document.getElementById('pieChart'));
          chart.draw(response.getDataTable(), {
            title: 'Percentages of Student in each Building',
            width: 500,
            height: 400,
            chartArea: {'width': '100%', 'height': '80%'},
            is3D: true
          });
        });
        // Send the query data to build Google Maps
        Query.send(initialize);
      }
      
      function initialize() {
        //var data = response.getDataTable();
        var mapOptions = {
          center: { lat: -34.397, lng: 150.644},
          zoom: 8
        };
        
        map = new google.maps.Map(document.getElementById('map-canvas'), {
                center: new google.maps.LatLng(41.076571, -81.514519),
                zoom: 17,
                maxZoom: 17,
                minZoom: 15,
                zoomControlOptions:{    style: google.maps.ZoomControlStyle.LARGE,
                                        position: google.maps.ControlPosition.left_top},
                                        mapTypeId: google.maps.MapTypeId.ROADMAP,
                                        //Turn off the map controls as we will be adding our own later.
                                        panControl: false,
                                        mapTypeControl: false,
                                        streetViewControl: false
        });
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
<div id="map-canvas" style="width:100%;"></div>
  </body>
</html>
